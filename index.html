<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>工数実績収集フォーム（QR対応・PCカメラ安定版）</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel（JSX用）※プリセット明示が超重要 -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- jsQR -->
  <script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>

  <!-- 製造ラインマスタ（どちらか一方でOK） -->
  <!-- 1) 既存ファイル名が日本語のままなら： -->
  <script src="製造ラインマスタ.js"></script>
  <!-- 2) ASCIIファイル名にした場合（推奨）： -->
  <!-- <script src="seizo_line_master.js"></script> -->

  <!-- 画面にエラーを出す簡易オーバーレイ（白画面つぶし） -->
  <script>
    function showErr(msg, stack) {
      const d = document.createElement('div');
      d.style.cssText = 'position:fixed;inset:0;background:#111;color:#fff;padding:16px;z-index:99999;overflow:auto;font-family:ui-monospace,Consolas,monospace';
      d.innerHTML = '<h2 class="text-lg font-bold mb-2">Runtime Error</h2><pre style="white-space:pre-wrap">'
        + (msg || 'unknown') + '\n' + (stack || '') + '</pre>';
      document.body.appendChild(d);
    }
    window.addEventListener('error', e => showErr(e.message, e.error && e.error.stack));
    window.addEventListener('unhandledrejection', e => {
      const r = e.reason || {};
      showErr(r.message || String(r), r.stack || '');
    });
  </script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <!-- アプリ本体 -->
  <script type="text/babel" data-presets="env,react">
    const { useState, useRef, useEffect } = React;

    // --- アイコン（簡易SVG） ---
    const Camera = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
        <circle cx="12" cy="13" r="4"></circle>
      </svg>
    );
    const Download = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );
    const Plus = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    const Trash2 = ({ size = 18 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );
    const RefreshCw = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
      </svg>
    );

    function WorkHoursForm() {
      // 入力/一覧
      const [records, setRecords] = useState([]);
      const [currentRecord, setCurrentRecord] = useState({
        date: new Date().toISOString().split('T')[0],
        orderNumber: '',
        locationCode: '',
        lineCode: '',
        process: '',
        setup: '',
        production: '',
        allowance: '',
        unpacking: '',
        rework: '',
        people: ''
      });
      const [errors, setErrors] = useState({});

      // QR/カメラ
      const [isScanning, setIsScanning] = useState(false);
      const [scanError, setScanError] = useState('');
      const videoRef = useRef(null);
      const canvasRef = useRef(null);
      const streamRef = useRef(null);
      const jsQRRef = useRef(null);

      // カメラ選択
      const [cameras, setCameras] = useState([]);
      const [selectedDeviceId, setSelectedDeviceId] = useState('');

      // マスタ
      const [lineMaster, setLineMaster] = useState([]);
      const [filteredLines, setFilteredLines] = useState([]);
      const [masterLoadError, setMasterLoadError] = useState('');

      const locationCodeOptions = ['M0HZ', 'M1HZ', 'M2HZ', 'M3HZ', 'M4HZ'];
      const processOptions = ['充填', '包装'];

      // jsQR 読み込み確認＆マスタ読込＆カメラ列挙
      useEffect(() => {
        const checkJsQR = () => {
          if (window.jsQR) jsQRRef.current = window.jsQR;
        };
        checkJsQR();
        const timer = setTimeout(checkJsQR, 1000);

        loadMasterData();
        enumerateCameras(); // デバイス列挙

        return () => clearTimeout(timer);
      }, []);

      // locationCode変更でラインを絞る
      useEffect(() => {
        if (currentRecord.locationCode && lineMaster.length > 0) {
          const filtered = lineMaster.filter(line =>
            line.製造場所コード === currentRecord.locationCode &&
            (line.使用停止フラグ === 0 || line.使用停止フラグ === '0')
          );
          setFilteredLines(filtered);
          if (currentRecord.lineCode && !filtered.find(l => l.製造ラインコード === currentRecord.lineCode)) {
            handleInputChange('lineCode', '');
          }
        } else {
          setFilteredLines([]);
          if (currentRecord.lineCode) handleInputChange('lineCode', '');
        }
      }, [currentRecord.locationCode, lineMaster]);

      // --- マスタ読込（日本語 or ASCII の双方に対応） ---
      const loadMasterData = () => {
        try {
          const src =
            (typeof 製造ラインマスタ !== 'undefined' && Array.isArray(製造ラインマスタ)) ? 製造ラインマスタ :
            (typeof SEIZO_LINE_MASTER !== 'undefined' && Array.isArray(SEIZO_LINE_MASTER)) ? SEIZO_LINE_MASTER :
            null;

          if (src) {
            const active = src.filter(row => (row.使用停止フラグ === 0 || row.使用停止フラグ === '0'));
            setLineMaster(active);
            setMasterLoadError('');
          } else {
            setMasterLoadError('製造ラインマスタが読み込まれていません（製造ラインマスタ.js/SEIZO_LINE_MASTER を確認）');
          }
        } catch (err) {
          setMasterLoadError('製造ラインマスタの読み込みに失敗: ' + err.message);
        }
      };

      // --- カメラ列挙（ラベル取得のため一度permission取りにいく）---
      const enumerateCameras = async () => {
        try {
          try {
            await navigator.mediaDevices.getUserMedia({ video: true });
          } catch (_) { /* 許可がなくても列挙できる場合あり */ }
          const devices = await navigator.mediaDevices.enumerateDevices();
          const cams = devices.filter(d => d.kind === 'videoinput');
          setCameras(cams);
          if (cams.length > 0 && !selectedDeviceId) setSelectedDeviceId(cams[0].deviceId);
        } catch (e) {
          console.warn('カメラ列挙に失敗:', e);
        }
      };

      // --- 入力変更 ---
      const handleInputChange = (field, value) => {
        setCurrentRecord(prev => ({ ...prev, [field]: value }));
        if (errors[field]) {
          setErrors(prev => {
            const ne = { ...prev };
            delete ne[field];
            return ne;
          });
        }
      };

      const handleOrderNumberBlur = () => {
        if (currentRecord.orderNumber) {
          const numbers = currentRecord.orderNumber.replace(/\D/g, '');
          const paddedNumber = numbers.padStart(15, '0').slice(0, 15);
          setCurrentRecord(prev => ({ ...prev, orderNumber: paddedNumber }));
        }
      };

      // --- QR開始 ---
      const startQRScan = async () => {
        if (!window.jsQR) {
          setScanError('QRコードライブラリをロード中です…');
          for (let i = 0; i < 10; i++) {
            await new Promise(r => setTimeout(r, 500));
            if (window.jsQR) { jsQRRef.current = window.jsQR; break; }
          }
        }
        if (!jsQRRef.current) {
          setScanError('QRライブラリの読み込みに失敗。ページを再読み込みしてください。');
          return;
        }
        setScanError('');

        try {
          const constraints = selectedDeviceId
            ? { video: { deviceId: { exact: selectedDeviceId } } }
            : { video: true };

          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          streamRef.current = stream;

          const v = videoRef.current;
          if (v) {
            v.srcObject = stream;
            v.setAttribute('playsinline', '');
            v.setAttribute('autoplay', '');
            v.muted = true;

            const playSafe = () => v.play().catch(err => {
              console.error('video.play()失敗:', err);
              setScanError('ビデオ再生に失敗: ' + err.message);
            });

            if (v.readyState >= 1) {
              await playSafe();
            } else {
              v.onloadedmetadata = async () => { await playSafe(); };
            }
          }

          setIsScanning(true);
          scanQRCode();
        } catch (err) {
          if (err.name === 'NotAllowedError') {
            setScanError('カメラアクセスが拒否されました。ブラウザの許可設定を確認してください。');
          } else if (err.name === 'NotFoundError' || err.name === 'OverconstrainedError') {
            setScanError('指定のカメラが見つかりません。別のカメラを選択してください。');
          } else {
            setScanError('カメラアクセスに失敗: ' + err.message);
          }
          console.error(err);
        }
      };

      // --- QRループ（縮小描画で安定） ---
      const scanQRCode = () => {
        if (!videoRef.current || !canvasRef.current || !jsQRRef.current || !isScanning) return;

        const video = videoRef.current;
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');

        if (video.readyState === video.HAVE_ENOUGH_DATA) {
          const vw = video.videoWidth || 0;
          const vh = video.videoHeight || 0;

          if (vw > 0 && vh > 0) {
            const maxSide = 720;
            const scale = Math.min(1, maxSide / Math.max(vw, vh));
            canvas.width = Math.round(vw * scale);
            canvas.height = Math.round(vh * scale);

            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const img = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQRRef.current(img.data, img.width, img.height, { inversionAttempts: 'dontInvert' });

            if (code && code.data) {
              handleInputChange('orderNumber', String(code.data));
              stopQRScan();
              return;
            }
          }
        }
        setTimeout(scanQRCode, 60); // 少し間引く
      };

      const stopQRScan = () => {
        if (streamRef.current) {
          streamRef.current.getTracks().forEach(t => t.stop());
          streamRef.current = null;
        }
        setIsScanning(false);
      };

      // --- バリデーション ---
      const validateRecord = () => {
        const newErrors = {};
        if (!currentRecord.date) newErrors.date = '必須項目です。入力してください';
        if (!currentRecord.orderNumber) newErrors.orderNumber = '必須項目です。入力してください';
        if (!currentRecord.locationCode) newErrors.locationCode = '必須項目です。入力してください';
        if (!currentRecord.lineCode) newErrors.lineCode = '必須項目です。入力してください';
        if (!currentRecord.process) newErrors.process = '必須項目です。入力してください';
        if (!currentRecord.setup) newErrors.setup = '必須項目です。入力してください';
        if (!currentRecord.production) newErrors.production = '必須項目です。入力してください';
        if (!currentRecord.allowance) newErrors.allowance = '必須項目です。入力してください';
        if (!currentRecord.unpacking) newErrors.unpacking = '必須項目です。入力してください';
        if (!currentRecord.rework) newErrors.rework = '必須項目です。入力してください';
        if (!currentRecord.people) newErrors.people = '必須項目です。入力してください';

        const timeFields = ['setup','production','allowance','unpacking','rework'];
        timeFields.forEach(f => {
          if (currentRecord[f] !== '') {
            const v = parseFloat(currentRecord[f]);
            if (!isNaN(v)) {
              if (v < 0) newErrors[f] = '負数は入力できません';
              else if ((v * 4) % 1 !== 0) newErrors[f] = '0.25h単位で入力してください';
            }
          }
        });

        if (currentRecord.people !== '') {
          const v = parseFloat(currentRecord.people);
          if (!isNaN(v) && !Number.isInteger(v)) newErrors.people = '整数で入力してください';
        }

        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
      };

      const addRecord = () => {
        if (!validateRecord()) return;
        setRecords(prev => [...prev, { ...currentRecord, id: Date.now() }]);
        setCurrentRecord({
          date: new Date().toISOString().split('T')[0],
          orderNumber: '',
          locationCode: '',
          lineCode: '',
          process: '',
          setup: '',
          production: '',
          allowance: '',
          unpacking: '',
          rework: '',
          people: ''
        });
        setErrors({});
      };

      const deleteRecord = (id) => {
        setRecords(prev => prev.filter(r => r.id !== id));
      };

      const downloadCSV = () => {
        if (records.length === 0) {
          alert('ダウンロードするデータがありません');
          return;
        }
        const headers = ['記入日','指図書番号','製造場所コード','製造ラインコード','工程','段取り','実生産','余裕','開梱','手直し','人数'];
        const csv = [
          headers.join(','),
          ...records.map(r => [
            r.date, r.orderNumber, r.locationCode, r.lineCode, r.process,
            r.setup, r.production, r.allowance, r.unpacking, r.rework, r.people
          ].join(','))
        ].join('\n');

        const bom = '\uFEFF';
        const blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `工数実績_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      return (
        <div className="min-h-screen p-4">
          <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
              <h1 className="text-2xl font-bold text-gray-800 mb-6">工数実績収集フォーム</h1>

              {/* マスタファイル管理 */}
              <div className="mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm font-medium text-gray-700">製造ラインマスタ</p>
                    {masterLoadError ? (
                      <p className="text-xs text-red-600">{masterLoadError}</p>
                    ) : lineMaster.length > 0 ? (
                      <p className="text-xs text-green-600">読み込み済み（{lineMaster.length}件）</p>
                    ) : (
                      <p className="text-xs text-yellow-600">データがありません</p>
                    )}
                  </div>
                  <button
                    onClick={loadMasterData}
                    className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm flex items-center gap-2"
                  >
                    <RefreshCw size={16} />
                    製造ラインマスタ読込
                  </button>
                </div>
              </div>

              {/* カメラ選択 */}
              <div className="mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="md:col-span-2">
                    <label className="block text-sm font-medium text-gray-700 mb-1">使用カメラ</label>
                    <select
                      value={selectedDeviceId}
                      onChange={(e) => setSelectedDeviceId(e.target.value)}
                      className="w-full px-3 py-2 border rounded-lg"
                    >
                      {cameras.length === 0 && <option value="">（カメラが見つかりません）</option>}
                      {cameras.map((c, i) => (
                        <option key={c.deviceId} value={c.deviceId}>
                          {c.label || `カメラ ${i + 1}`}
                        </option>
                      ))}
                    </select>
                    <p className="text-xs text-gray-500 mt-1">※ ブラウザ許可後にラベルが表示されます</p>
                  </div>
                  <div className="flex items-end">
                    <button
                      onClick={enumerateCameras}
                      className="w-full md:w-auto px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 text-sm"
                    >
                      カメラ再検出
                    </button>
                  </div>
                </div>
              </div>

              {/* スキャナビュー */}
              {isScanning && (
                <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                  <div className="flex justify-between items-center mb-3">
                    <h3 className="font-semibold text-gray-700">QRコードをスキャン</h3>
                    <button
                      onClick={stopQRScan}
                      className="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm"
                    >
                      キャンセル
                    </button>
                  </div>
                  <video
                    ref={videoRef}
                    className="w-full rounded-lg object-contain bg-black"
                    autoPlay
                    muted
                    playsInline
                  />
                  <canvas ref={canvasRef} className="hidden" />
                </div>
              )}

              {scanError && (
                <div className="mb-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm">
                  {scanError}
                </div>
              )}

              {/* 入力エリア */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">記入日 <span className="text-red-500">*</span></label>
                  <input
                    type="date"
                    value={currentRecord.date}
                    onChange={(e) => handleInputChange('date', e.target.value)}
                    className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.date ? 'border-red-500' : 'border-gray-300'}`}
                  />
                  {errors.date && <p className="text-red-500 text-xs mt-1">{errors.date}</p>}
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">指図書番号 <span className="text-red-500">*</span></label>
                  <div className="flex gap-2">
                    <div className="flex-1">
                      <input
                        type="text"
                        value={currentRecord.orderNumber}
                        onChange={(e) => handleInputChange('orderNumber', e.target.value)}
                        onBlur={handleOrderNumberBlur}
                        placeholder="手入力またはスキャン"
                        className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.orderNumber ? 'border-red-500' : 'border-gray-300'}`}
                      />
                      {errors.orderNumber && <p className="text-red-500 text-xs mt-1">{errors.orderNumber}</p>}
                    </div>
                    <button
                      onClick={startQRScan}
                      disabled={isScanning}
                      className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-400"
                      title="カメラを起動してQRを読み取る"
                    >
                      <Camera size={20} />
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">製造場所コード <span className="text-red-500">*</span></label>
                  <select
                    value={currentRecord.locationCode}
                    onChange={(e) => handleInputChange('locationCode', e.target.value)}
                    className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.locationCode ? 'border-red-500' : 'border-gray-300'}`}
                  >
                    <option value="">選択してください</option>
                    {locationCodeOptions.map(code => <option key={code} value={code}>{code}</option>)}
                  </select>
                  {errors.locationCode && <p className="text-red-500 text-xs mt-1">{errors.locationCode}</p>}
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">製造ラインコード <span className="text-red-500">*</span></label>
                  <select
                    value={currentRecord.lineCode}
                    onChange={(e) => handleInputChange('lineCode', e.target.value)}
                    disabled={!currentRecord.locationCode || filteredLines.length === 0}
                    className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.lineCode ? 'border-red-500' : 'border-gray-300'} disabled:bg-gray-100 disabled:cursor-not-allowed`}
                  >
                    <option value="">選択してください</option>
                    {filteredLines.map(line => (
                      <option key={line.製造ラインコード} value={line.製造ラインコード}>
                        {line.製造ラインコード} - {line.製造ライン名}
                      </option>
                    ))}
                  </select>
                  {errors.lineCode && <p className="text-red-500 text-xs mt-1">{errors.lineCode}</p>}
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">工程 <span className="text-red-500">*</span></label>
                  <select
                    value={currentRecord.process}
                    onChange={(e) => handleInputChange('process', e.target.value)}
                    className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.process ? 'border-red-500' : 'border-gray-300'}`}
                  >
                    <option value="">選択してください</option>
                    {processOptions.map(p => <option key={p} value={p}>{p}</option>)}
                  </select>
                  {errors.process && <p className="text-red-500 text-xs mt-1">{errors.process}</p>}
                </div>

                {[
                  { key:'setup', label:'段取り（時間）' },
                  { key:'production', label:'実生産（時間）' },
                  { key:'allowance', label:'余裕（時間）' },
                  { key:'unpacking', label:'開梱（時間）' },
                  { key:'rework', label:'手直し（時間）' },
                ].map(f => (
                  <div key={f.key}>
                    <label className="block text-sm font-medium text-gray-700 mb-1">{f.label} <span className="text-red-500">*</span></label>
                    <input
                      type="number"
                      step="0.25"
                      min="0"
                      value={currentRecord[f.key]}
                      onChange={(e) => handleInputChange(f.key, e.target.value)}
                      className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors[f.key] ? 'border-red-500' : 'border-gray-300'}`}
                    />
                    {errors[f.key] && <p className="text-red-500 text-xs mt-1">{errors[f.key]}</p>}
                  </div>
                ))}

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">人数 <span className="text-red-500">*</span></label>
                  <input
                    type="number"
                    step="1"
                    min="1"
                    value={currentRecord.people}
                    onChange={(e) => handleInputChange('people', e.target.value)}
                    className={`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.people ? 'border-red-500' : 'border-gray-300'}`}
                  />
                  {errors.people && <p className="text-red-500 text-xs mt-1">{errors.people}</p>}
                </div>
              </div>

              <button
                onClick={addRecord}
                className="w-full py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold flex items-center justify-center gap-2"
              >
                <Plus size={20} />
                レコードを追加
              </button>
            </div>

            {records.length > 0 && (
              <div className="bg-white rounded-lg shadow-md p-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold text-gray-800">
                    登録済みデータ（{records.length}件）
                  </h2>
                  <button
                    onClick={downloadCSV}
                    className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2"
                  >
                    <Download size={20} />
                    CSV出力
                  </button>
                </div>

                <div className="overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-3 py-2 text-left text-gray-700">記入日</th>
                        <th className="px-3 py-2 text-left text-gray-700">指図書番号</th>
                        <th className="px-3 py-2 text-left text-gray-700">製造場所</th>
                        <th className="px-3 py-2 text-left text-gray-700">製造ライン</th>
                        <th className="px-3 py-2 text-left text-gray-700">工程</th>
                        <th className="px-3 py-2 text-right text-gray-700">段取り</th>
                        <th className="px-3 py-2 text-right text-gray-700">実生産</th>
                        <th className="px-3 py-2 text-right text-gray-700">余裕</th>
                        <th className="px-3 py-2 text-right text-gray-700">開梱</th>
                        <th className="px-3 py-2 text-right text-gray-700">手直し</th>
                        <th className="px-3 py-2 text-right text-gray-700">人数</th>
                        <th className="px-3 py-2 text-center text-gray-700">操作</th>
                      </tr>
                    </thead>
                    <tbody>
                      {records.map(record => (
                        <tr key={record.id} className="border-t border-gray-200 hover:bg-gray-50">
                          <td className="px-3 py-2">{record.date}</td>
                          <td className="px-3 py-2">{record.orderNumber}</td>
                          <td className="px-3 py-2">{record.locationCode}</td>
                          <td className="px-3 py-2">{record.lineCode}</td>
                          <td className="px-3 py-2">{record.process}</td>
                          <td className="px-3 py-2 text-right">{record.setup}</td>
                          <td className="px-3 py-2 text-right">{record.production}</td>
                          <td className="px-3 py-2 text-right">{record.allowance}</td>
                          <td className="px-3 py-2 text-right">{record.unpacking}</td>
                          <td className="px-3 py-2 text-right">{record.rework}</td>
                          <td className="px-3 py-2 text-right">{record.people}</td>
                          <td className="px-3 py-2 text-center">
                            <button
                              onClick={() => deleteRecord(record.id)}
                              className="text-red-500 hover:text-red-700"
                            >
                              <Trash2 size={18} />
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WorkHoursForm />);
  </script>
</body>
</html>
